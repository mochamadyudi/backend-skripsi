{"version":3,"sources":["../../../../src/api/middlewares/auth/verifyCurrentUser.js"],"names":["Request","Response","NextFunction","YuyuidError","verifyCurrentUser","req","res","next","console","log","userRecord","User","findById","token","userId","unauthorized","currentUser","toJSON","Reflect","deleteProperty","user","id","e"],"mappings":"AAAA,SAASA,OAAT,EAAkBC,QAAlB,EAA4BC,YAA5B,QAAgD,SAAhD;AACA,OAAOC,WAAP,MAAwB,mBAAxB;AACA;;;AAIA,MAAMC,oBAAoB,OAAOC,GAAP,EAAWC,GAAX,EAAeC,IAAf,KAAuB;AAC7C,QAAG;AACCC,gBAAQC,GAAR,CAAYJ,GAAZ;AACA,cAAMK,aAAa,MAAMC,KAAKC,QAAL,CAAcP,IAAIQ,KAAJ,CAAUC,MAAxB,CAAzB;AACA,YAAI,CAACJ,UAAL,EAAgB;AACZ,kBAAMP,YAAYY,YAAZ,EAAN;AACH;AACD,YAAIC,cAAcN,WAAWO,MAAX,EAAlB;AACAC,gBAAQC,cAAR,CAAuBH,WAAvB,EAAmC,UAAnC;AACAE,gBAAQC,cAAR,CAAuBH,WAAvB,EAAoC,MAApC;AACAX,YAAIe,IAAJ,GAAW;AACPJ,uBADO;AAEPF,oBAAQE,YAAYK;AAFb,SAAX;AAIA,eAAOd,MAAP;AACH,KAdD,CAcC,OAAMe,CAAN,EAAQ;AACL,eAAOf,KAAKe,CAAL,CAAP;AACH;AACJ,CAlBD;;AAoBA,eAAelB,iBAAf","file":"verifyCurrentUser.js","sourcesContent":["import { Request, Response, NextFunction } from \"express\";\r\nimport YuyuidError from \"@yuyuid/exception\";\r\n// import { User } from \"@bitevo/models\";\r\n\r\n\r\n\r\nconst verifyCurrentUser = async (req,res,next)=> {\r\n    try{\r\n        console.log(req)\r\n        const userRecord = await User.findById(req.token.userId)\r\n        if (!userRecord){\r\n            throw YuyuidError.unauthorized();\r\n        }\r\n        let currentUser = userRecord.toJSON();\r\n        Reflect.deleteProperty(currentUser,\"password\")\r\n        Reflect.deleteProperty(currentUser, \"salt\")\r\n        req.user = {\r\n            currentUser,\r\n            userId: currentUser.id\r\n        }\r\n        return next();\r\n    }catch(e){\r\n        return next(e);\r\n    }\r\n}\r\n\r\nexport default verifyCurrentUser\r\n"]}